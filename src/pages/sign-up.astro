---
export const prerender = false; // Not needed in 'server' mode
import {auth} from '../lib/auth';
try {
  const data = await Astro.request.formData();
  const rawName = data.get('name');
  const rawEmail = data.get('email');
  const rawPassword = data.get('password');

  // Ensure values are strings (FormDataEntryValue can be string or File)
  if (typeof rawName !== 'string' || typeof rawEmail !== 'string' || typeof rawPassword !== 'string' || !rawName || !rawEmail || !rawPassword) {
    throw new Error('Name, email, and password are required');
  }

  const name = rawName;
  const email = rawEmail;
  const password = rawPassword;

  const result = await auth.api.signUpEmail(
    {
      body: {
        name,
        email,
        password,
      }
    }
  );
  if (result instanceof Response) {
    let json = null;
    try { json = await result.json(); } catch (_) {}
    if (result.ok) {
      // Handle successful sign up
      return;
    }
    // Handle error
    return;
  }
} catch (err) {
  // Handle error
}

---

<h1>Sign up</h1>
<form id="signup-form" method="POST">
  <label>
    Name
    <input name="name" type="text" required />
  </label>
  <label>
    Email
    <input name="email" type="email" required />
  </label>
  <label>
    Password
    <input name="password" type="password" required />
  </label>
  <button type="submit">Create account</button>
</form>
